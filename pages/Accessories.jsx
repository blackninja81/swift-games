import Head from "next/head";
import Image from "next/image";
import Footer from "../Components/Layout/Footer";
import TopBar from "../Components/Layout/TopBar";
import React, { useState, useEffect } from "react";
import Category from "../Components/HomePage/Category";
import Playstation from "../Assets/banners/Accessory2.jpg";
import { getAccessories } from "../lib/Providers/Accessories";
import ItemCard from "../Components/ItemsPage/AccessoriesCard";
import { ThemeContext, AccessoryContext } from "../context/Context";

const Accessory = ( {res} ) => {
  const storage = typeof window !== "undefined" ? localStorage.theme : "light";
  const [theme, setTheme] = useState(storage);

  useEffect(() => {
    if (localStorage.getItem("theme") !== theme) {
      const setString = JSON.stringify(theme);
      window.localStorage.setItem("theme", setString);
    }
  }, [theme]);

  useEffect(() => {
    if (typeof window !== "undefined") {
      const getString = window.localStorage.getItem("theme");
      const state = JSON.parse(getString);
      setTheme(state);
    }
  }, [theme]);

  const toggleTheme = () => {
    setTheme((curr) => (curr === "light" ? "dark" : "light"));
  };

  return (
    <ThemeContext.Provider value={{ theme, toggleTheme }}>
      <div id={theme}>
        <Head>
          <title>Swift Games | Accessories</title>
          <meta name="description" content="Generated by create next app" />
          <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link rel="icon" href="/favicon.ico" />
        </Head>
        <div className="playstation-page">
          <TopBar />
          <h1>Gaming Accessories 1</h1>
          <Image
            width="auto"
            height="auto"
            src={Playstation}
            alt="image description"
          />
          <AccessoryContext.Provider value={{res}}>
            <ItemCard />
          </AccessoryContext.Provider>
          <Category />
          <Footer />
        </div>
      </div>
    </ThemeContext.Provider>
  );
};

export const getServerSideProps = async () => {
  const res = await getAccessories();
  
  return {
    props: { res },
  };
};

export default Accessory;
